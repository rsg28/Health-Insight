<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ollama API Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 16px;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
        }
        h1 {
            font-size: 24px;
            margin-bottom: 16px;
        }
        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 12px 24px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
            width: 100%;
        }
        #results {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 16px;
            margin-top: 16px;
            white-space: pre-wrap;
            word-wrap: break-word;
            min-height: 200px;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        .info {
            color: #2196F3;
        }
    </style>
</head>
<body>
    <h1>Ollama API Test</h1>
    <p>This page tests the connection to your Ollama API via the Docker proxy.</p>
    
    <div>
        <label for="apiUrl">API URL:</label>
        <input type="text" id="apiUrl" style="width: 100%; padding: 8px; margin: 8px 0;" 
               value="http://209.87.57.234:12434">
    </div>
    
    <div>
        <label for="modelName">Model Name:</label>
        <input type="text" id="modelName" style="width: 100%; padding: 8px; margin: 8px 0;" 
               value="llama3">
    </div>
    
    <button id="testRoot">Test Root Connection</button>
    <button id="testApi">Test API Connection</button>
    <button id="testGenerate">Test Model Generation</button>
    
    <div id="results">Results will appear here...</div>
    
    <script>
        const resultsDiv = document.getElementById('results');
        
        function log(message, type = 'info') {
            const now = new Date().toLocaleTimeString();
            resultsDiv.innerHTML += `<div class="${type}">[${now}] ${message}</div>`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function clearResults() {
            resultsDiv.innerHTML = '';
        }
        
        document.getElementById('testRoot').addEventListener('click', async () => {
            clearResults();
            const apiUrl = document.getElementById('apiUrl').value.trim();
            
            if (!apiUrl) {
                log('Please enter an API URL', 'error');
                return;
            }
            
            log(`Testing connection to ${apiUrl}...`);
            
            try {
                const startTime = Date.now();
                const response = await fetch(apiUrl);
                const endTime = Date.now();
                
                if (response.ok) {
                    log(`✅ Connection successful! (${endTime - startTime}ms)`, 'success');
                    log(`Status: ${response.status}`);
                    
                    try {
                        const data = await response.text();
                        log(`Response: ${data.substring(0, 100)}${data.length > 100 ? '...' : ''}`);
                    } catch (e) {
                        log(`Could not read response: ${e.message}`, 'error');
                    }
                } else {
                    log(`❌ Connection failed with status: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`❌ Connection failed: ${error.message}`, 'error');
            }
        });
        
        document.getElementById('testApi').addEventListener('click', async () => {
            clearResults();
            const apiUrl = document.getElementById('apiUrl').value.trim();
            
            if (!apiUrl) {
                log('Please enter an API URL', 'error');
                return;
            }
            
            log(`Testing API endpoint at ${apiUrl}/api/...`);
            
            try {
                const startTime = Date.now();
                const response = await fetch(`${apiUrl}/api`);
                const endTime = Date.now();
                
                if (response.ok) {
                    log(`✅ API connection successful! (${endTime - startTime}ms)`, 'success');
                    log(`Status: ${response.status}`);
                    
                    try {
                        const data = await response.text();
                        log(`Response: ${data.substring(0, 100)}${data.length > 100 ? '...' : ''}`);
                    } catch (e) {
                        log(`Could not read response: ${e.message}`, 'error');
                    }
                } else {
                    log(`❌ API connection failed with status: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`❌ API connection failed: ${error.message}`, 'error');
            }
        });
        
        document.getElementById('testGenerate').addEventListener('click', async () => {
            clearResults();
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const modelName = document.getElementById('modelName').value.trim();
            
            if (!apiUrl) {
                log('Please enter an API URL', 'error');
                return;
            }
            
            if (!modelName) {
                log('Please enter a model name', 'error');
                return;
            }
            
            log(`Testing model generation at ${apiUrl}/api/generate...`);
            log(`Using model: ${modelName}`);
            
            try {
                const startTime = Date.now();
                const response = await fetch(`${apiUrl}/api/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: modelName,
                        prompt: 'Say "Hello from browser test"',
                        stream: false,
                        options: {
                            temperature: 0.7,
                            max_tokens: 30
                        }
                    })
                });
                const endTime = Date.now();
                
                if (response.ok) {
                    log(`✅ Request successful! (${endTime - startTime}ms)`, 'success');
                    log(`Status: ${response.status}`);
                    
                    try {
                        const data = await response.json();
                        if (data && data.response) {
                            log(`Model response: "${data.response.trim()}"`, 'success');
                        } else {
                            log(`Response format is not as expected: ${JSON.stringify(data).substring(0, 100)}`, 'error');
                        }
                    } catch (e) {
                        log(`Could not parse JSON response: ${e.message}`, 'error');
                    }
                } else {
                    log(`❌ Request failed with status: ${response.status}`, 'error');
                    try {
                        const text = await response.text();
                        log(`Error response: ${text.substring(0, 100)}`, 'error');
                    } catch (e) {
                        log(`Could not read error response: ${e.message}`, 'error');
                    }
                }
            } catch (error) {
                log(`❌ Request failed: ${error.message}`, 'error');
            }
        });
    </script>
</body>
</html> 